<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monte Carlo Integration Visualizer</title>
    <link href="./dist/output.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0c0a09; /* stone-950 */
            overflow: hidden;
        }
        .main-container {
            display: flex;
            height: calc(100vh - 65px);
        }
        #left-panel {
            flex-basis: 320px;
            flex-shrink: 0;
            min-width: 250px;
            background: rgba(17, 24, 39, 0.8); /* bg-gray-900 with opacity */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
        }
        #resize-handle {
            flex-basis: 6px;
            flex-shrink: 0;
            cursor: col-resize;
            background-color: rgba(55, 65, 81, 0.5); /* gray-700 with opacity */
            transition: background-color 0.2s ease;
        }
        #resize-handle:hover {
            background-color: rgba(59, 130, 246, 0.7); /* blue-500 with opacity */
        }
        #right-panel {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 0;
            background-color: #0c0a09;
        }
        canvas {
            width: 100%;
            height: 100%;
            background-color: #111827; /* gray-900 */
        }
        #left-panel::-webkit-scrollbar { width: 8px; }
        #left-panel::-webkit-scrollbar-track { background: #1f2937; } /* gray-800 */
        #left-panel::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; } /* gray-600 */
        #left-panel::-webkit-scrollbar-thumb:hover { background: #6b7280; } /* gray-500 */

        .btn { @apply text-white font-semibold py-2 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 disabled:opacity-50 disabled:cursor-not-allowed; }
        .btn-green { @apply bg-emerald-600 hover:bg-emerald-700 focus:ring-emerald-500; }
        .btn-blue { @apply bg-sky-600 hover:bg-sky-700 focus:ring-sky-500; }
        .btn-gray { @apply bg-gray-600 hover:bg-gray-700 focus:ring-gray-500; }
    </style>
</head>
<body class="text-gray-200 flex flex-col h-screen">

    <header class="text-center py-4 bg-gray-900/80 border-b border-gray-700/50" style="flex-shrink: 0;">
        <h1 class="text-2xl md:text-3xl text-white font-bold tracking-tight">Monte Carlo Integration Visualizer</h1>
    </header>

    <div class="main-container">
        <!-- Left Control Panel -->
        <div id="left-panel">
            <div>
                <h2 class="text-lg font-semibold text-white mb-3 border-b border-gray-600 pb-2">Controls</h2>
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-3">
                        <button id="startPauseBtn" class="btn btn-green">Start</button>
                        <button id="resetBtn" class="btn btn-gray">Reset</button>
                    </div>
                     <div>
                        <label for="functionSelector" class="block text-sm font-medium text-gray-300">Function f(x) on [0, 1]</label>
                        <select id="functionSelector" class="w-full bg-gray-800 text-white rounded-md px-3 py-2 mt-1 border border-gray-600 focus:ring-2 focus:ring-sky-500 focus:outline-none"></select>
                    </div>
                    <div>
                        <label for="pointsSlider" class="block text-sm font-medium text-gray-300">Number of Points: <span id="pointsValue">10000</span></label>
                        <input id="pointsSlider" type="range" min="1000" max="100000" value="10000" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
                    </div>
                </div>
                
                <div class="mt-6 pt-4 border-t border-gray-600">
                     <h3 class="text-md font-semibold text-white mb-2">How It Works</h3>
                     <p class="text-gray-400 text-sm">
                        This tool estimates the integral of a function f(x). It generates random points in a rectangular area that contains the curve and counts how many fall underneath it. The estimated area is the ratio of points under the curve to the total points, multiplied by the area of the rectangle.
                     </p>
                </div>
                 <div class="mt-4 grid grid-cols-2 gap-4">
                    <div>
                        <h3 class="text-md font-semibold text-white mb-2 text-center">Estimate</h3>
                        <div id="integralEstimate" class="text-2xl text-amber-400 font-bold text-center bg-gray-800/50 p-3 rounded-lg min-h-[40px]">0.0000</div>
                    </div>
                    <div>
                        <h3 class="text-md font-semibold text-white mb-2 text-center">Actual</h3>
                        <div id="actualIntegral" class="text-2xl text-sky-400 font-bold text-center bg-gray-800/50 p-3 rounded-lg min-h-[40px]">N/A</div>
                    </div>
                </div>
            </div>
            <footer class="mt-auto pt-4">
                <p class="text-xs text-gray-500 text-center">NitaD, Univ Paris-Saclay, 2025.</p>
            </footer>
        </div>

        <div id="resize-handle"></div>

        <div id="right-panel">
            <canvas id="mcCanvas"></canvas>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('mcCanvas');
            const ctx = canvas.getContext('2d');
            const leftPanel = document.getElementById('left-panel');
            const rightPanel = document.getElementById('right-panel');
            const resizeHandle = document.getElementById('resize-handle');
            const startPauseBtn = document.getElementById('startPauseBtn');
            const resetBtn = document.getElementById('resetBtn');
            const pointsSlider = document.getElementById('pointsSlider');
            const pointsValueSpan = document.getElementById('pointsValue');
            const functionSelector = document.getElementById('functionSelector');
            const integralEstimateDiv = document.getElementById('integralEstimate');
            const actualIntegralDiv = document.getElementById('actualIntegral');

            let isResizing = false;
            let maxPoints = 10000;
            let isRunning = false;
            let points = [];
            let pointsUnderCurve = 0;
            let totalPoints = 0;
            let userFunction = null;
            let simulationHandle = null;
            let actualIntegral = null;
            let yMax = 1.1;

            const KNOWN_FUNCTIONS = [
                { display: "sin(πx)", code: "Math.sin(x * Math.PI)", integral: 2 / Math.PI, yMax: 1.1 },
                { display: "√(1 - x²)", code: "Math.sqrt(1 - x*x)", integral: Math.PI / 4, yMax: 1.1 },
                { display: "x", code: "x", integral: 0.5, yMax: 1.1 },
                { display: "x²", code: "x*x", integral: 1/3, yMax: 1.1 },
                { display: "√x", code: "Math.sqrt(x)", integral: 2/3, yMax: 1.1 },
                { display: "cos(πx)", code: "Math.cos(x * Math.PI)", integral: 0, yMax: 1.1 },
                { display: "eˣ", code: "Math.exp(x)", integral: Math.E - 1, yMax: Math.E * 1.05 },
                { display: "ln(1+x)", code: "Math.log(1 + x)", integral: 2 * Math.log(2) - 1, yMax: 1.1 },
                { display: "1 / (1+x²)", code: "1 / (1 + x*x)", integral: Math.PI / 4, yMax: 1.1 },
                { display: "xeˣ", code: "x * Math.exp(x)", integral: 1, yMax: Math.E * 1.05 },
                { display: "1", code: "1", integral: 1, yMax: 1.1 },
            ];

            const COLOR = {
                BACKGROUND: '#111827',
                AXIS: 'rgba(255, 255, 255, 0.3)',
                CURVE: '#38bdf8', // sky-400
                POINT_UNDER: 'rgba(52, 211, 153, 0.7)', // emerald-400
                POINT_ABOVE: 'rgba(251, 113, 133, 0.7)', // rose-400
            };

            function populateSelector() {
                KNOWN_FUNCTIONS.forEach((func, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = func.display;
                    functionSelector.appendChild(option);
                });
            }

            function parseFunction() {
                const selectedIndex = functionSelector.value;
                const functionString = KNOWN_FUNCTIONS[selectedIndex].code;
                try {
                    userFunction = new Function('x', `return ${functionString}`);
                    userFunction(0.5); // Test the function
                    return true;
                } catch (e) {
                    console.error("Function parsing error:", e);
                    return false;
                }
            }

            function setup() {
                if (simulationHandle) {
                    cancelAnimationFrame(simulationHandle);
                    simulationHandle = null;
                }
                isRunning = false;
                startPauseBtn.textContent = 'Start';
                startPauseBtn.disabled = false;
                startPauseBtn.classList.remove('btn-blue', 'btn-gray');
                startPauseBtn.classList.add('btn-green');
                pointsSlider.disabled = false;
                functionSelector.disabled = false;

                if (!parseFunction()) return;
                
                const selectedIndex = functionSelector.value;
                actualIntegral = KNOWN_FUNCTIONS[selectedIndex].integral;
                yMax = KNOWN_FUNCTIONS[selectedIndex].yMax;
                actualIntegralDiv.textContent = actualIntegral.toFixed(4);

                maxPoints = parseInt(pointsSlider.value);
                pointsValueSpan.textContent = maxPoints.toLocaleString();
                
                points = [];
                pointsUnderCurve = 0;
                totalPoints = 0;
                integralEstimateDiv.textContent = '0.0000';
                
                resizeCanvas();
            }

            function resizeCanvas() {
                canvas.width = rightPanel.clientWidth;
                canvas.height = rightPanel.clientHeight;
                draw();
            }

            function draw() {
                ctx.fillStyle = COLOR.BACKGROUND;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                const padding = 40;
                const plotWidth = canvas.width - padding * 2;
                const plotHeight = canvas.height - padding * 2;

                // --- Draw Axes ---
                ctx.strokeStyle = COLOR.AXIS;
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(padding, padding);
                ctx.lineTo(padding, padding + plotHeight);
                ctx.lineTo(padding + plotWidth, padding + plotHeight);
                ctx.stroke();

                // --- Draw Labels ---
                ctx.fillStyle = COLOR.AXIS;
                ctx.font = '12px Inter';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('0', padding - 10, padding + plotHeight + 10);
                ctx.fillText('1', padding + plotWidth, padding + plotHeight + 10);
                ctx.textAlign = 'right';
                ctx.fillText(yMax.toFixed(1), padding - 10, padding);
                
                // --- Draw Function Curve ---
                if (userFunction) {
                    ctx.strokeStyle = COLOR.CURVE;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    for (let i = 0; i <= plotWidth; i++) {
                        const x = i / plotWidth;
                        const y = userFunction(x);
                        const canvasX = padding + i;
                        const canvasY = padding + plotHeight - ((y / yMax) * plotHeight);
                        if (i === 0) {
                            ctx.moveTo(canvasX, canvasY);
                        } else {
                            ctx.lineTo(canvasX, canvasY);
                        }
                    }
                    ctx.stroke();
                }

                // --- Draw Points ---
                const pointRadius = Math.max(1, 4000 / maxPoints);
                for(const point of points) {
                    const canvasX = padding + point.x * plotWidth;
                    const canvasY = padding + plotHeight - ((point.y / yMax) * plotHeight);
                    ctx.fillStyle = point.isUnder ? COLOR.POINT_UNDER : COLOR.POINT_ABOVE;
                    ctx.beginPath();
                    ctx.arc(canvasX, canvasY, pointRadius, 0, 2 * Math.PI);
                    ctx.fill();
                }
            }
            
            function simulationLoop() {
                if (!isRunning) return;

                const batchSize = Math.ceil(maxPoints / 200); 
                for (let i = 0; i < batchSize && totalPoints < maxPoints; i++) {
                    const x = Math.random();
                    const y = Math.random() * yMax;
                    
                    let functionValue = userFunction(x);
                    const isUnder = y >= 0 && y <= functionValue;

                    if (isUnder) {
                        pointsUnderCurve++;
                    }
                    points.push({ x, y, isUnder });
                    totalPoints++;
                }

                const estimate = (pointsUnderCurve / totalPoints) * yMax;
                integralEstimateDiv.textContent = estimate.toFixed(4);

                if (totalPoints >= maxPoints) {
                    isRunning = false;
                    startPauseBtn.textContent = 'Done';
                    startPauseBtn.disabled = true;
                    startPauseBtn.classList.remove('btn-green', 'btn-blue');
                    startPauseBtn.classList.add('btn-gray');
                } else {
                    simulationHandle = requestAnimationFrame(simulationLoop);
                }
                 draw();
            }

            startPauseBtn.addEventListener('click', () => {
                isRunning = !isRunning;
                if (isRunning) {
                    startPauseBtn.textContent = 'Pause';
                    startPauseBtn.classList.remove('btn-green');
                    startPauseBtn.classList.add('btn-blue');
                    pointsSlider.disabled = true;
                    functionSelector.disabled = true;
                    simulationLoop();
                } else {
                    startPauseBtn.textContent = 'Resume';
                    startPauseBtn.classList.remove('btn-blue');
                    startPauseBtn.classList.add('btn-green');
                    if (simulationHandle) {
                        cancelAnimationFrame(simulationHandle);
                        simulationHandle = null;
                    }
                }
            });

            resetBtn.addEventListener('click', setup);
            
            pointsSlider.addEventListener('input', (e) => {
                pointsValueSpan.textContent = parseInt(e.target.value).toLocaleString();
            });
            pointsSlider.addEventListener('change', setup);
            functionSelector.addEventListener('change', setup);

            resizeHandle.addEventListener('mousedown', () => { isResizing = true; document.body.style.cursor = 'col-resize'; document.body.style.userSelect = 'none'; });
            document.addEventListener('mousemove', (e) => { if (isResizing) { const newWidth = e.clientX; if (newWidth > 250 && newWidth < window.innerWidth - 250) { leftPanel.style.flexBasis = `${newWidth}px`; resizeCanvas(); } } });
            document.addEventListener('mouseup', () => { isResizing = false; document.body.style.cursor = 'default'; document.body.style.userSelect = ''; });
            window.addEventListener('resize', resizeCanvas);

            populateSelector();
            setup();
        });
    </script>
</body>
</html>


